%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Dreuw & Deselaer's Poster
% LaTeX Template
% Version 1.0 (11/04/13)
%
% Created by:
% Philippe Dreuw and Thomas Deselaers
% http://www-i6.informatik.rwth-aachen.de/~dreuw/latexbeamerposter.php
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
% PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[final,hyperref={pdfpagelabels=false}]{beamer}

% Use the beamerposter package for laying out the poster with a portrait orientation and an a0 paper size
\usepackage[size=custom, width=76.2, height=101.6, scale=1.4]{beamerposter}

% Choose beamerposter theme
\usetheme{/ORNL}

% English language/hyphenation
\usepackage[english]{babel}

% For including math equations, theorems, symbols, etc
\usepackage{amsmath,amsthm,amssymb,latexsym}

\usepackage{tikz}
\newcommand\PlaceText[3]{%
\begin{tikzpicture}[remember picture,overlay]
\node[outer sep=0pt,inner sep=0pt,anchor=south west]
  at ([xshift=#1,yshift=-#2]current page.north west) {#3};
\end{tikzpicture}%
}
% Code coloring
\usepackage{listings}
\lstdefinelanguage{SWIG}{%
  keywords={module,include,apply}
}
\definecolor{hellgelb} {rgb}{1.0,1.0,0.8}
\definecolor{darkgreen}{rgb}{0.0,0.2,0.13}
\lstset{%
  backgroundcolor=\color{hellgelb!95!MSUgreen},
  % backgroundcolor=\color{white!92!MSUgreen},
  basicstyle=\bf\ttfamily\small,
  breakautoindent=true,
  breaklines=true,
  captionpos=b,
  commentstyle=\color{orange},
  escapechar=|,
  extendedchars=true,
  float=hbp,
  frame=single,
  identifierstyle=\color{black},
  keywordstyle=\color{blue},
  numberstyle=\tiny,
  showspaces=false,
  showstringspaces=false,
  stringstyle=\color{purple},
  tabsize=2,
}
%\usepackage{times}\usefonttheme{professionalfonts}  % Uncomment to use Times as the main font
%\usefonttheme[onlymath]{serif} % Uncomment to use a Serif font within math environments

% Use bold for everything within the math environment
\boldmath

% Top and bottom rules for tables
\usepackage{booktabs}

% Location of the graphics files
\graphicspath{{figs/}}

% A fix for figure numbering
\usecaptiontemplate{\small\structure{\insertcaptionname~\insertcaptionnumber: }\insertcaption}

\usepackage{subcaption}

%----------------------------------------------------------------------------------------
% TITLE SECTION
%----------------------------------------------------------------------------------------

% Poster title
% \title{\huge Parallel Bounding Volume Hierarchy Implementation using MPI+Kokkos}
\title{\huge ArborX, a performance-portable geometric search library}

% Author(s)
\author{D.~Arndt, \textbf{D.~Lebrun-Grandi{\'e}}, A.~Prokopenko, B.~Turcksin}

% Institution(s)
\institute{Oak Ridge National Laboratory}

%----------------------------------------------------------------------------------------
% FOOTER TEXT
%----------------------------------------------------------------------------------------

\newcommand{\leftfoot}{}%{http://www.LaTeXTemplates.com} % Left footer text

\newcommand{\rightfoot}{}%{john@smith.com} % Right footer text

%----------------------------------------------------------------------------------------
\begin{document}

% White space under blocks
\addtobeamertemplate{block end}{}{\vspace*{2ex}}

% The whole poster is enclosed in one beamer frame
\begin{frame}[t,fragile]

% The whole poster consists of two major columns, each of which can be
% subdivided further with another \begin{columns} block - the [t] argument
% aligns each column's content to the top
\begin{columns}[t]

%========================================================================================
% Empty spacer column
\begin{column}{.02\textwidth}\end{column}

% The first column
\begin{column}{.450\textwidth}

%----------------------------------------------------------------------------------------
% DESCRIPTION
%----------------------------------------------------------------------------------------
\begin{block}{\centering Motivation}

  Search for close geometric objects in space is an important algorithm of many
  scientific applications.
  Examples include computing interpolation for overlapping meshes, finding
  mesh intersections, iterative closest point algorithm, collision detection, particle simulations, etc.
  This search procedure has to be distributed for large scale simulations, and
  be able to work on both accelerators (such as GPU) and host side, without a
  need to move the application data.

  We developed a portable search capability based on bounding volume
  hierarchy~(BVH) structure. It is based on MPI+Kokkos, and allows for both
  spatial and nearest search algorithms.
\end{block}

%----------------------------------------------------------------------------------------
% CONSTRUCTION
%----------------------------------------------------------------------------------------
\begin{block}{\centering Tree Construction}

  Bounding volume hierarchy (BVH) is a tree structure on a set of geometric
  objects.  All objects are wrapped in a conservative bounding volumes
  that form the leaf nodes of the tree.  These nodes are then grouped based on their
  being located close to each other and enclosed within larger bounding volumes, and so on.

  The construction of the BVH is done in several stages:
  \begin{enumerate}
    \item User-provided geometric objects are wrapped in axis-aligned bounding boxes and the boundin box of the scene is computed (reduction)
    \item
      A Morton code is assigned to each object

      \begin{center}
      \includegraphics[scale=1.5]{figures/an18/fig04-z-curve.png}

        {\small (T.~Karras, NVIDIA)}
      \end{center}
    \item
      Objects are sorted according to their Morton codes
    \item
      The binary tree is constructed fully in parallel [Karras2012]

      \begin{center}
      \includegraphics[width=.4\textwidth]{figures/ornl19/small.pdf}
      \includegraphics[width=.5\textwidth]{figures/ornl19/small.png}
      \end{center}
    \item
      The bounding boxes are calculated for all internal nodes
  \end{enumerate}

  \

  In distributed setting, there are \textbf{two} trees:
  \begin{itemize}
    \item
      The \textbf{lower tree} is a local BVH tree for on-node data.
    \item
      The \textbf{upper tree} is a BVH tree where the geometric objects are the
      roots of local BVH trees. This tree is replicated among nodes.
  \end{itemize}

\end{block}

%----------------------------------------------------------------------------------------
\end{column} % End of the first column

%========================================================================================
% Empty spacer column
\begin{column}{.03\textwidth}\end{column}

% The second column
\begin{column}{.480\textwidth}

%----------------------------------------------------------------------------------------
% TRAVERSAL
%----------------------------------------------------------------------------------------
\begin{block}{\centering Tree Traversal}
  Two distinct flavors of search:

  \begin{itemize}
    \item \textbf{Spatial search}

      Example: find all the neighbors within a specified radius $r$ of the target point.
      Internal data structure: \textbf{stack}.

    \item \textbf{Nearest search}

      Example: find the predefined $k$ closest neighbors to the target point
      (kNN).
      Internal data structure: \textbf{priority queue}.

  \end{itemize}

  All queries are done in parallel. Each thread gets a target for search.
  Threads traverse the tree independently starting from the root
  node.

  It is critical to minimize both \textbf{code} and \textbf{data divergence}.
  This is done through sorting the queries so that local threads correspond to
  objects that are close to each other.

\begin{center}
  \includegraphics[width=.3\textwidth]{figures/ornl19/leaf_418_untouched.png}
  \includegraphics[width=.3\textwidth]{figures/ornl19/leaf_881_shuffled.png}
  \includegraphics[width=.3\textwidth]{figures/ornl19/leaf_881_sorted.png}
\end{center}

\end{block}

%----------------------------------------------------------------------------------------
% API
%----------------------------------------------------------------------------------------
\begin{block}{\centering Proposed API}

\begin{lstlisting}[language=C++]
MPI_Comm comm;
using Primitive = ArborX::Point;
Kokkos::View<Primitive*, DeviceType> points;
// ... user-provided collection of points ...
ArborX::DistributedSearchTree bvh( comm, points );
using Predicate = ArborX::Intersects<ArborX::Sphere>;
Kokkos::View<Predicate*, DeviceType> queries;
// ... conditions that must be met by predicates ...
auto [offset, indices, ranks] = query( bvh, queries );
\end{lstlisting}

\end{block}

%----------------------------------------------------------------------------------------
% RESULTS
%----------------------------------------------------------------------------------------
\begin{block}{\centering Results}

\includegraphics[width=.3\textwidth]{figures/ornl19/comparison_construction_filled_box.png}
\includegraphics[width=.3\textwidth]{figures/ornl19/comparison_knn_search_filled_box.png}
\includegraphics[width=.3\textwidth]{figures/ornl19/comparison_radius_search_filled_box.png}

\includegraphics[width=.3\textwidth]{figures/ornl19/scaling_construction_filled_box.png}
\includegraphics[width=.3\textwidth]{figures/ornl19/scaling_knn_search_filled_box.png}
\includegraphics[width=.3\textwidth]{figures/ornl19/scaling_radius_search_filled_box.png}

\begin{center}
  \small
  CPU: Intel Xeon E5-2698 \qquad GPU: NVIDIA Tesla V100
\end{center}

\end{block}

%----------------------------------------------------------------------------------------
% INFORMATION
%----------------------------------------------------------------------------------------
\begin{block}{\centering More information}
  github.com/ORNL-CEES/DataTransferKit
  devblogs.nvidia.com/thinking-parallel-part-iii-tree-construction-gpu
\end{block}

%----------------------------------------------------------------------------------------
% End of the second column
\end{column}

% Empty spacer column
\begin{column}{.015\textwidth}\end{column}

% End of all the columns in the poster
\end{columns}
%========================================================================================

\vfill

\begin{center}
\footnotesize
This research was supported by the Exascale Computing Project (17-SC-20-SC), a
collaborative effort of the U.S. Department of Energy Office of Science and the
National Nuclear Security Administration.

Research sponsored by the Laboratory
Directed Research and Development Program of Oak Ridge National Laboratory,
managed by UT-Battelle, LLC, for the U.S. Department of Energy.
\end{center}


\begin{center}
  \includegraphics[height=3.5cm]{logos/ORNL_cut_and_alpha.jpg}\hspace{7ex}
  \includegraphics[height=4cm]{logos/ECP_transparent.png}\hspace{5ex}
  \includegraphics[height=3.5cm]{logos/DOE.png}\hspace{7ex}
\end{center}

% End of the enclosing frame
\end{frame}

\end{document}
